<?xml version="1.0" encoding="utf-8"?>
<Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2016/01/reportdefinition"
        xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner">
  <AutoRefresh>0</AutoRefresh>

  <!-- ===== DataSources ===== -->
  <DataSources>
    <DataSource Name="IAReportDataSet">
      <ConnectionProperties>
        <DataProvider>System.Data.DataSet</DataProvider>
        <ConnectString>/* Local Connection */</ConnectString>
      </ConnectionProperties>
      <rd:DataSourceID>IAReportDataSet-guid-placeholder</rd:DataSourceID>
    </DataSource>
  </DataSources>

  <!-- ===== DataSets ===== -->
  <DataSets>
    <DataSet Name="IADataSource">
      <Query>
        <DataSourceName>IAReportDataSet</DataSourceName>
        <CommandText>/* Local Query */</CommandText>
      </Query>
      <Fields>
        <Field Name="Register_Number"><DataField>Register_Number</DataField><rd:TypeName>System.String</rd:TypeName></Field>
        <Field Name="Name"><DataField>Name</DataField><rd:TypeName>System.String</rd:TypeName></Field>
        <Field Name="Sem"><DataField>Sem</DataField><rd:TypeName>System.Int32</rd:TypeName></Field>
        <Field Name="Course_Code"><DataField>Course_Code</DataField><rd:TypeName>System.String</rd:TypeName></Field>
        <Field Name="Course_Name"><DataField>Course_Name</DataField><rd:TypeName>System.String</rd:TypeName></Field>
        <Field Name="Assessment_ID"><DataField>Assessment_ID</DataField><rd:TypeName>System.Int32</rd:TypeName></Field>
        <Field Name="Assessment_Name"><DataField>Assessment_Name</DataField><rd:TypeName>System.String</rd:TypeName></Field>
        <Field Name="Max_Marks"><DataField>Max_Marks</DataField><rd:TypeName>System.Decimal</rd:TypeName></Field>
        <Field Name="Marks"><DataField>Marks</DataField><rd:TypeName>System.Decimal</rd:TypeName></Field>
        <Field Name="IsTotal"><DataField>IsTotal</DataField><rd:TypeName>System.Boolean</rd:TypeName></Field>
        <Field Name="TotalMarks"><DataField>TotalMarks</DataField><rd:TypeName>System.Decimal</rd:TypeName></Field>
        <Field Name="CourseOrder"><DataField>CourseOrder</DataField><rd:TypeName>System.Int32</rd:TypeName></Field>
      </Fields>
      <rd:DataSetInfo>
        <rd:DataSetName>IAReportDataSet</rd:DataSetName>
        <rd:TableName>IAData</rd:TableName>
      </rd:DataSetInfo>
    </DataSet>
  </DataSets>

  <!-- ===== Parameters ===== -->
  <ReportParameters>
    <ReportParameter Name="PageCourseCount">
      <DataType>Integer</DataType>
      <DefaultValue><Values><Value>2</Value></Values></DefaultValue>
      <Prompt>Courses Per Page</Prompt>
    </ReportParameter>
  </ReportParameters>

  <ReportSections>
    <ReportSection>
      <Body>
        <ReportItems>

          <!-- OUTER Tablix: group per student -->
          <Tablix Name="lstStudent">
            <TablixBody>
              <TablixColumns>
                <TablixColumn><Width>19cm</Width></TablixColumn>
              </TablixColumns>
              <TablixRows>

                <!-- Student header -->
                <TablixRow>
                  <Height>1cm</Height>
                  <TablixCells>
                    <TablixCell>
                      <CellContents>
                        <Tablix Name="tblStudentHeader">
                          <TablixBody>
                            <TablixColumns>
                              <TablixColumn><Width>6cm</Width></TablixColumn>
                              <TablixColumn><Width>9cm</Width></TablixColumn>
                              <TablixColumn><Width>4cm</Width></TablixColumn>
                            </TablixColumns>
                            <TablixRows>
                              <TablixRow>
                                <Height>0.9cm</Height>
                                <TablixCells>
                                  <TablixCell>
                                    <CellContents>
                                      <Textbox Name="txtRegNo">
                                        <Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!Register_Number.Value</Value></TextRun></TextRuns></Paragraph></Paragraphs>
                                        <Style>
                                          <BackgroundColor>Gainsboro</BackgroundColor>
                                          <Border><Color>LightGrey</Color><Style>Solid</Style></Border>
                                          <PaddingLeft>4pt</PaddingLeft><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom>
                                          <FontWeight>Bold</FontWeight>
                                        </Style>
                                      </Textbox>
                                    </CellContents>
                                  </TablixCell>
                                  <TablixCell>
                                    <CellContents>
                                      <Textbox Name="txtName">
                                        <Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!Name.Value</Value></TextRun></TextRuns></Paragraph></Paragraphs>
                                        <Style>
                                          <BackgroundColor>Gainsboro</BackgroundColor>
                                          <Border><Color>LightGrey</Color><Style>Solid</Style></Border>
                                          <PaddingLeft>4pt</PaddingLeft><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom>
                                          <FontWeight>Bold</FontWeight>
                                        </Style>
                                      </Textbox>
                                    </CellContents>
                                  </TablixCell>
                                  <TablixCell>
                                    <CellContents>
                                      <Textbox Name="txtSem">
                                        <Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!Sem.Value</Value></TextRun></TextRuns></Paragraph></Paragraphs>
                                        <Style>
                                          <BackgroundColor>Gainsboro</BackgroundColor>
                                          <Border><Color>LightGrey</Color><Style>Solid</Style></Border>
                                          <PaddingLeft>4pt</PaddingLeft><PaddingTop>2pt</PaddingTop><PaddingBottom>2pt</PaddingBottom>
                                          <TextAlign>Right</TextAlign>
                                          <FontWeight>Bold</FontWeight>
                                        </Style>
                                      </Textbox>
                                    </CellContents>
                                  </TablixCell>
                                </TablixCells>
                              </TablixRow>
                            </TablixRows>
                          </TablixBody>
                          <TablixColumnHierarchy><TablixMembers><TablixMember/><TablixMember/><TablixMember/></TablixMembers></TablixColumnHierarchy>
                          <TablixRowHierarchy><TablixMembers><TablixMember/></TablixMembers></TablixRowHierarchy>
                        </Tablix>
                      </CellContents>
                    </TablixCell>
                  </TablixCells>
                </TablixRow>

                <!-- Course batch (2 courses per page) -->
                <TablixRow>
                  <Height>7.5cm</Height>
                  <TablixCells>
                    <TablixCell>
                      <CellContents>

                        <!-- Batch tablix -->
                        <Tablix Name="lstCourseBatch">
                          <TablixBody>
                            <TablixColumns>
                              <TablixColumn><Width>19cm</Width></TablixColumn>
                            </TablixColumns>
                            <TablixRows>
                              <TablixRow>
                                <Height>7.5cm</Height>
                                <TablixCells>
                                  <TablixCell>
                                    <CellContents>

                                      <!-- MATRIX: rows = Assessment, columns = Course_Code (dynamic) -->
                                      <Tablix Name="mxCourses">
                                        <TablixBody>
                                          <TablixColumns>
                                            <!-- Row header (assessment) -->
                                            <TablixColumn><Width>6cm</Width></TablixColumn>
                                            <!-- Dynamic data column; replicated by column group -->
                                            <TablixColumn><Width>6.5cm</Width></TablixColumn>
                                          </TablixColumns>
                                          <TablixRows>

                                            <!-- Header row -->
                                            <TablixRow>
                                              <Height>0.8cm</Height>
                                              <TablixCells>
                                                <TablixCell>
                                                  <CellContents>
                                                    <Textbox Name="thAssess">
                                                      <Paragraphs><Paragraph><TextRuns><TextRun><Value>Assessment</Value></TextRun></TextRuns></Paragraph></Paragraphs>
                                                      <Style>
                                                        <BackgroundColor>LightSteelBlue</BackgroundColor>
                                                        <FontWeight>Bold</FontWeight>
                                                        <Border><Color>LightGrey</Color><Style>Solid</Style></Border>
                                                        <PaddingLeft>4pt</PaddingLeft>
                                                      </Style>
                                                    </Textbox>
                                                  </CellContents>
                                                </TablixCell>
                                                <TablixCell>
                                                  <CellContents>
                                                    <Textbox Name="thCourse">
                                                      <Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!Course_Code.Value</Value></TextRun></TextRuns></Paragraph></Paragraphs>
                                                      <Style>
                                                        <BackgroundColor>LightSteelBlue</BackgroundColor>
                                                        <TextAlign>Center</TextAlign>
                                                        <FontWeight>Bold</FontWeight>
                                                        <Border><Color>LightGrey</Color><Style>Solid</Style></Border>
                                                      </Style>
                                                    </Textbox>
                                                  </CellContents>
                                                </TablixCell>
                                              </TablixCells>
                                            </TablixRow>

                                            <!-- Data row -->
                                            <TablixRow>
                                              <Height>0.65cm</Height>
                                              <TablixCells>
                                                <!-- Assessment name -->
                                                <TablixCell>
                                                  <CellContents>
                                                    <Textbox Name="tdAssessName">
                                                      <Paragraphs><Paragraph><TextRuns><TextRun><Value>=Fields!Assessment_Name.Value</Value></TextRun></TextRuns></Paragraph></Paragraphs>
                                                      <Style>
                                                        <Border><Color>LightGrey</Color><Style>Solid</Style></Border>
                                                        <PaddingLeft>4pt</PaddingLeft>
                                                      </Style>
                                                    </Textbox>
                                                  </CellContents>
                                                </TablixCell>

                                                <!-- Marks / Total with 40% highlighting -->
                                                <TablixCell>
                                                  <CellContents>
                                                    <Textbox Name="tdMarks">
                                                      <Paragraphs><Paragraph><TextRuns><TextRun><Value>=IIF(Fields!IsTotal.Value, Fields!TotalMarks.Value, Fields!Marks.Value)</Value></TextRun></TextRuns></Paragraph></Paragraphs>
                                                      <Style>
                                                        <TextAlign>Center</TextAlign>
                                                        <Border><Color>LightGrey</Color><Style>Solid</Style></Border>
                                                        <Color>=IIF(Fields!IsTotal.Value AND Fields!TotalMarks.Value &lt; (0.4 * 50), "Red", "Black")</Color>
                                                        <FontWeight>=IIF(Fields!IsTotal.Value AND Fields!TotalMarks.Value &lt; (0.4 * 50), "Bold", "Normal")</FontWeight>
                                                      </Style>
                                                    </Textbox>
                                                  </CellContents>
                                                </TablixCell>
                                              </TablixCells>
                                            </TablixRow>

                                          </TablixRows>
                                        </TablixBody>

                                        <!-- Column hierarchy: dynamic Course_Code (NO filters here) -->
                                        <TablixColumnHierarchy>
                                          <TablixMembers>
                                            <TablixMember /> <!-- Assessment stub column -->
                                            <TablixMember>
                                              <Group Name="grpCourse">
                                                <GroupExpressions>
                                                  <GroupExpression>=Fields!Course_Code.Value</GroupExpression>
                                                </GroupExpressions>
                                              </Group>
                                            </TablixMember>
                                          </TablixMembers>
                                        </TablixColumnHierarchy>

                                        <!-- Row hierarchy: Assessment (sorting moved to TablixMember level) -->
                                        <TablixRowHierarchy>
                                          <TablixMembers>
                                            <TablixMember>
                                              <Group Name="grpAssess">
                                                <GroupExpressions>
                                                  <GroupExpression>=Fields!Assessment_Name.Value</GroupExpression>
                                                </GroupExpressions>
                                              </Group>
                                              <SortExpressions>
                                                <SortExpression>
                                                  <Value>=IIF(Fields!IsTotal.Value, 9999, Fields!Assessment_ID.Value)</Value>
                                                </SortExpression>
                                              </SortExpressions>
                                            </TablixMember>
                                          </TablixMembers>
                                        </TablixRowHierarchy>

                                      </Tablix>
                                    </CellContents>
                                  </TablixCell>
                                </TablixCells>
                              </TablixRow>
                            </TablixRows>
                          </TablixBody>

                          <!-- Batch grouping: 2 courses per page -->
                          <TablixColumnHierarchy><TablixMembers><TablixMember/></TablixMembers></TablixColumnHierarchy>
                          <TablixRowHierarchy>
                            <TablixMembers>
                              <TablixMember>
                                <Group Name="grpCourseBatch">
                                  <GroupExpressions>
                                    <GroupExpression>=Ceiling(CDec(Fields!CourseOrder.Value) / CDec(Parameters!PageCourseCount.Value))</GroupExpression>
                                  </GroupExpressions>
                                  <PageBreak><BreakLocation>Between</BreakLocation></PageBreak>
                                </Group>
                              </TablixMember>
                            </TablixMembers>
                          </TablixRowHierarchy>
                        </Tablix>

                      </CellContents>
                    </TablixCell>
                  </TablixCells>
                </TablixRow>

              </TablixRows>
            </TablixBody>
            <TablixColumnHierarchy><TablixMembers><TablixMember/></TablixMembers></TablixColumnHierarchy>
            <TablixRowHierarchy>
              <TablixMembers>
                <TablixMember>
                  <Group Name="grpStudent">
                    <GroupExpressions>
                      <GroupExpression>=Fields!Register_Number.Value</GroupExpression>
                    </GroupExpressions>
                  </Group>
                </TablixMember>
              </TablixMembers>
            </TablixRowHierarchy>
          </Tablix>

        </ReportItems>
        <Height>10in</Height>
        <Style/>
      </Body>

      <Width>21cm</Width>
      <Page>
        <PageHeight>29.7cm</PageHeight>
        <PageWidth>21cm</PageWidth>
        <LeftMargin>1cm</LeftMargin>
        <RightMargin>1cm</RightMargin>
        <TopMargin>1cm</TopMargin>
        <BottomMargin>1cm</BottomMargin>
        <Style/>
      </Page>
    </ReportSection>
  </ReportSections>

  <rd:ReportUnitType>Cm</rd:ReportUnitType>
  <rd:ReportID>3b6f4c2e-3c1f-4b66-9c7a-7a1e77d0a111</rd:ReportID>
</Report>
